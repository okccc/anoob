

### 电商业务分析
```sql
-- 订单表和订单详情表区别：订单表有订单状态且周期性变化,订单详情表没有
-- spu是一类商品,比如iphone6s
-- sku是更细分的单位,比如iphone6s/64g/玫瑰金/全网通版
-- ods层
create external table if not exists ods_order_info (
    id string COMMENT '订单编号',
    total_amount decimal(10,2) COMMENT '订单金额',
    order_status string COMMENT '订单状态',
    user_id string COMMENT '用户id',
    payment_way string COMMENT '支付方式',
    out_trade_no string COMMENT '支付流水号',
    create_time string COMMENT '创建时间',
    operate_time string COMMENT '操作时间'
) COMMENT '订单表'
PARTITIONED BY (dt string)
row format delimited fields terminated by '\t'
location '/warehouse/gmall/ods/ods_order_info/';

create external table if not exists ods_order_detail( 
    id string COMMENT '订单编号',
    order_id string  COMMENT '订单号', 
    user_id string COMMENT '用户id',
    sku_id string COMMENT '商品id',
    sku_name string COMMENT '商品名称',
    order_price string COMMENT '商品价格',
    sku_num string COMMENT '商品数量',
    create_time string COMMENT '创建时间'
) COMMENT '订单明细表'
PARTITIONED BY (dt string)
row format delimited fields terminated by '\t' 
location '/warehouse/gmall/ods/ods_order_detail/';

create external table if not exists ods_sku_info( 
    id string COMMENT 'skuId',
    spu_id string   COMMENT 'spuid', 
    price decimal(10,2) COMMENT '价格',
    sku_name string COMMENT '商品名称',
    sku_desc string COMMENT '商品描述',
    weight string COMMENT '重量',
    tm_id string COMMENT '品牌id',
    category3_id string COMMENT '品类id',
    create_time string COMMENT '创建时间'
) COMMENT '商品表'
PARTITIONED BY (dt string)
row format delimited fields terminated by '\t'
location '/warehouse/gmall/ods/ods_sku_info/';

create external table if not exists ods_user_info( 
    id string COMMENT '用户id',
    name  string COMMENT '姓名',
    birthday string COMMENT '生日',
    gender string COMMENT '性别',
    email string COMMENT '邮箱',
    user_level string COMMENT '用户等级',
    create_time string COMMENT '创建时间'
) COMMENT '用户信息'
PARTITIONED BY (dt string)
row format delimited fields terminated by '\t'
location '/warehouse/gmall/ods/ods_user_info/';

create external table if not exists ods_base_category1( 
    id string COMMENT 'id',
    name  string COMMENT '名称'
) COMMENT '商品一级分类'
PARTITIONED BY (dt string)
row format delimited fields terminated by '\t'
location '/warehouse/gmall/ods/ods_base_category1/';

create external table if not exists ods_base_category2( 
    id string COMMENT ' id',
    name string COMMENT '名称',
    category1_id string COMMENT '一级品类id'
) COMMENT '商品二级分类'
PARTITIONED BY (dt string)
row format delimited fields terminated by '\t'
location '/warehouse/gmall/ods/ods_base_category2/';

create external table if not exists ods_base_category3(
    id string COMMENT ' id',
    name  string COMMENT '名称',
    category2_id string COMMENT '二级品类id'
) COMMENT '商品三级分类'
PARTITIONED BY (dt string)
row format delimited fields terminated by '\t'
location '/warehouse/gmall/ods/ods_base_category3/';

create external table if not exists ods_payment_info(
    id   bigint COMMENT '编号',
    out_trade_no    string COMMENT '对外业务编号',
    order_id        string COMMENT '订单编号',
    user_id         string COMMENT '用户编号',
    alipay_trade_no string COMMENT '支付宝交易流水编号',
    total_amount    decimal(16,2) COMMENT '支付金额',
    subject         string COMMENT '交易内容',
    payment_type    string COMMENT '支付类型',
    payment_time    string COMMENT '支付时间'
   )  COMMENT '支付流水表'
PARTITIONED BY (dt string)
row format delimited fields terminated by '\t'
location '/warehouse/gmall/ods/ods_payment_info/';

-- dwd层
create external table dwd_order_info (
    `id` string COMMENT '',
    `total_amount` decimal(10,2) COMMENT '',
    `order_status` string COMMENT ' 1 2 3 4 5',
    `user_id` string COMMENT 'id',
    `payment_way` string COMMENT '',
    `out_trade_no` string COMMENT '',
    `create_time` string COMMENT '',
    `operate_time` string COMMENT ''
)  COMMENT '订单表'
PARTITIONED BY (`dt` string)
stored as parquet
location '/warehouse/gmall/dwd/dwd_order_info/'
tblproperties ("parquet.compression"="snappy");

create external table dwd_order_detail( 
    `id` string COMMENT '',
    `order_id` decimal(10,2) COMMENT '', 
    `user_id` string COMMENT 'id',
    `sku_id` string COMMENT 'id',
    `sku_name` string COMMENT '',
    `order_price` string COMMENT '',
    `sku_num` string COMMENT '',
    `create_time` string COMMENT ''
)  comment '订单详情表'
PARTITIONED BY (`dt` string)
stored as parquet
location '/warehouse/gmall/dwd/dwd_order_detail/'
tblproperties ("parquet.compression"="snappy");

create external table dwd_user_info( 
    `id` string COMMENT 'id',
    `name` string COMMENT '', 
    `birthday` string COMMENT '',
    `gender` string COMMENT '',
    `email` string COMMENT '',
    `user_level` string COMMENT '',
    `create_time` string COMMENT ''
)  comment '用户表'
PARTITIONED BY (`dt` string)
stored as parquet
location '/warehouse/gmall/dwd/dwd_user_info/'
tblproperties ("parquet.compression"="snappy");

create external table dwd_payment_info(
    `id`   bigint COMMENT '',
    `out_trade_no`    string COMMENT '',
    `order_id`        string COMMENT '',
    `user_id`         string COMMENT '',
    `alipay_trade_no` string COMMENT '',
    `total_amount`    decimal(16,2) COMMENT '',
    `subject`         string COMMENT '',
    `payment_type`    string COMMENT '',
    `payment_time`    string COMMENT ''
   )  comment '支付流水表'
PARTITIONED BY (`dt` string)
stored as parquet
location '/warehouse/gmall/dwd/dwd_payment_info/'
tblproperties ("parquet.compression"="snappy");

create external table dwd_sku_info(
    `id` string COMMENT 'skuId',
    `spu_id` string COMMENT 'spuid',
    `price` decimal(10,2) COMMENT '',
    `sku_name` string COMMENT '',
    `sku_desc` string COMMENT '',
    `weight` string COMMENT '',
    `tm_id` string COMMENT 'id',
    `category3_id` string COMMENT '1id',
    `category2_id` string COMMENT '2id',
    `category1_id` string COMMENT '3id',
    `category3_name` string COMMENT '3',
    `category2_name` string COMMENT '2',
    `category1_name` string COMMENT '1',
    `create_time` string COMMENT ''
)  comment '商品表'
PARTITIONED BY (`dt` string)
stored as parquet
location '/warehouse/gmall/dwd/dwd_sku_info/'
tblproperties ("parquet.compression"="snappy");

create external table dwd_order_info_his(
    `id` string COMMENT '订单编号',
    `total_amount` decimal(10,2) COMMENT '订单金额',
    `order_status` string COMMENT '订单状态',
    `user_id` string COMMENT '用户id' ,
    `payment_way` string COMMENT '支付方式',
    `out_trade_no` string COMMENT '支付流水号',
    `create_time` string COMMENT '创建时间',
    `operate_time` string COMMENT '操作时间',
    `start_date`  string COMMENT '有效开始日期',
    `end_date`  string COMMENT '有效结束日期'
) COMMENT '订单拉链表'
stored as parquet
location '/warehouse/gmall/dwd/dwd_order_info_his/'
tblproperties ("parquet.compression"="snappy");

-- dws层
create external table dws_user_action 
(   
    user_id          string      comment '用户 id',
    order_count     bigint      comment '下单次数 ',
    order_amount    decimal(16,2)  comment '下单金额 ',
    payment_count   bigint      comment '支付次数',
    payment_amount  decimal(16,2) comment '支付金额 ',
    comment_count   bigint      comment '评论次数'
) COMMENT '每日用户行为宽表'
PARTITIONED BY (`dt` string)
stored as parquet
location '/warehouse/gmall/dws/dws_user_action/'
tblproperties ("parquet.compression"="snappy");
```